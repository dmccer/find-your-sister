// Generated by CoffeeScript 1.6.3
(function() {
  var meeting, query, seat, sysRecords;

  sysRecords = require('../db/sys').data;

  meeting = require('./meeting');

  seat = require('./seat');

  exports.getByEmployeeId = function(req, res) {
    var personInfo, seatNumber, seatRecord;
    personInfo = query('loginId', req.params.employeeId);
    if (personInfo && personInfo.length) {
      personInfo = personInfo[0];
    } else {
      personInfo = {};
    }
    personInfo.title = '个人信息';
    seatRecord = seat.query('loginId', req.params.employeeId);
    if (seatRecord.length) {
      seatNumber = seatRecord[0].seatNumber;
    } else {
      seatNumber = '没有登记座位';
    }
    personInfo.seatNumber = seatNumber;
    return res.render('person', personInfo);
  };

  query = exports.query = function(key, val) {
    return sysRecords.filter(function(item) {
      var result;
      if (key === 'loginId') {
        result = item.loginId === val;
      } else {
        result = item[key].indexOf(val) !== -1;
      }
      return result;
    });
  };

  exports.getByName = function(req, res) {
    res.setHeader('content-type', 'text/json;charset=UTF-8');
    return res.json(200, query('realName', req.params.name));
  };

  exports.get_dper_today_meetings = function(req, res) {
    var dper, dpers, meetings, result;
    if (req.params.name !== null) {
      meetings = meeting.queryDper("Name", req.params.name);
    }
    if (req.params.employeeId !== null) {
      dpers = query('loginId', req.params.employeeId);
    }
    dper = dpers[0];
    meetings = meeting.queryDper("Email", dpers[0].email);
    result = meetings.map(function(item) {
      var room;
      return room = {
        Name: dper.realName,
        MeetingRoom: item.MeetingRoom,
        STime: item.STime,
        ETime: item.ETime
      };
    });
    res.setHeader('content-type', 'text/json;charset=UTF-8');
    return res.json(200, result);
  };

}).call(this);
